SpongeBob has been entrusted by Mr. Krabs to keep the Krabby Patty formula safe. But in all the excitement, SpongeBob forgets where he put the formula. He then relies on the help of the most unlikely companion, Plankton. With the help of his friends, SpongeBob must use Plankton's memory machine to retrace the happiest moments of his life (because according to SpongeBob, he's unable to remember anything when he's sad) to find the Krabby Patty formula in time for the Krusty Krab's "eleventy-seventh" anniversary. Little does SpongeBob know, however, that Plankton wants the formula for himself and has inserted robots into SpongeBob's memories to extract the precise location of the formula. But after breaking the controller, Plankton has no choice but to go inside SpongeBob's memories instead. SpongeBob travels through his memories, fighting robots and robot bosses that look like Patrick and Squidward. He then remembers the formula is in the Krusty Krab safe. Plankton finds this out however and turns the entire Chum Bucket into one giant Plankton-Bot. After destroying it, SpongeBob tells Mr. Krabs the formula is in the safe, but then finds out it was in his back pocket the whole time. However, when he gives the paper to Mr. Krabs, he realizes that he gave him his lottery ticket and that the secret formula was in Mr. Krabs' back pocket the whole time.